# 03. 기능 갭 매트릭스 (Feature Gap Matrix)

## 범례

| 상태 | 의미 |
|------|------|
| ✅ | 구현 완료 |
| ⚠️ | 부분 구현 / 모델만 존재 |
| ❌ | 미구현 |
| 🔮 | Phase 2 (런칭 후) |

---

## A. DM/커뮤니티 기능 (카카오톡 수준 목표)

### A.1 메시지 기본 기능

| 기능 | 현재 상태 | 근거 파일 | 난이도 | Phase |
|------|----------|----------|--------|-------|
| 텍스트 메시지 | ✅ | `lib/data/models/broadcast_message.dart:63` | - | - |
| 이미지 메시지 | ✅ | `lib/features/artist_inbox/widgets/media_preview_confirmation.dart` | - | - |
| 동영상 메시지 | ✅ | `BroadcastMessageType.video` | - | - |
| 음성 메시지 | ✅ | `lib/features/chat/widgets/voice_message_widget.dart` | - | - |
| 파일 첨부 | ❌ | - | M | 2 |
| 전송중 상태 | ⚠️ | 로컬 상태만, 서버 확인 없음 | L | 1 |
| 전송 실패/재전송 | ❌ | - | M | 1 |
| 읽음 표시 | ⚠️ | 모델에 `isRead` 있으나 UI 없음 | M | 1 |
| 타이핑 인디케이터 | ⚠️ | `realtime_service.dart` 있으나 UI 없음 | L | 1 |
| 답장 (Reply) | ❌ | - | M | 1 |
| 인용 (Quote) | ❌ | - | M | 2 |
| 멘션 (@) | ❌ | - | H | 2 |
| 링크 프리뷰 | ❌ | - | M | 2 |

### A.2 메시지 편집/삭제

| 기능 | 현재 상태 | 근거 파일 | 난이도 | Phase |
|------|----------|----------|--------|-------|
| 보낸 메시지 편집 | ⚠️ | 모델: `isEdited`, `lastEditedAt`, `editHistory` | L | 1 |
| "편집됨" 표시 | ❌ | UI 없음 | L | 1 |
| 보낸 메시지 삭제 | ⚠️ | 모델: `deletedAt` 있음 | L | 1 |
| "삭제됨" 표시 | ❌ | UI 없음 | L | 1 |
| 삭제 취소 | ❌ | - | M | 2 |

### A.3 신고/차단

| 기능 | 현재 상태 | 근거 파일 | 난이도 | Phase |
|------|----------|----------|--------|-------|
| 메시지 신고 | ❌ | - | M | 1 |
| 신고 사유 선택 | ❌ | - | L | 1 |
| 사용자 차단 | ❌ | - | M | 1 |
| 차단 목록 관리 | ❌ | - | L | 1 |
| 차단된 사용자 메시지 숨김 | ❌ | - | M | 1 |

### A.4 리액션/이모지

| 기능 | 현재 상태 | 근거 파일 | 난이도 | Phase |
|------|----------|----------|--------|-------|
| 하트 리액션 | ⚠️ | CLAUDE.md에 언급 "하트 반응 버튼" | L | 1 |
| 다중 리액션 | ❌ | - | M | 2 |
| 커스텀 이모지 | ❌ | - | H | 2 |
| 스티커 | 🔮 | - | H | 2 |

### A.5 공지/핀/검색

| 기능 | 현재 상태 | 근거 파일 | 난이도 | Phase |
|------|----------|----------|--------|-------|
| 대화방 공지 | ❌ | - | M | 2 |
| 메시지 핀 고정 | ⚠️ | 모델: `ChatThread.isPinned` | L | 2 |
| 대화 검색 | ❌ | - | M | 2 |
| 미디어 모아보기 | ❌ | - | M | 2 |

### A.6 투표/이벤트

| 기능 | 현재 상태 | 근거 파일 | 난이도 | Phase |
|------|----------|----------|--------|-------|
| 투표 생성 | 🔮 | - | H | 2 |
| 투표 참여 | 🔮 | - | M | 2 |
| 투표 결과 | 🔮 | - | M | 2 |
| 일정 공유 | 🔮 | - | H | 2 |

### A.7 성능/동기화

| 기능 | 현재 상태 | 근거 파일 | 난이도 | Phase |
|------|----------|----------|--------|-------|
| 멀티디바이스 동기화 | ⚠️ | Supabase Realtime 기반 | M | 1 |
| 오프라인 캐시 | ❌ | Hive 있으나 미적용 | H | 1 |
| 메시지 페이지네이션 | ✅ | 50개씩 로드 | - | - |
| 가상화 (긴 목록) | ⚠️ | ListView.builder 사용 | L | 1 |

### A.8 푸시 알림

| 기능 | 현재 상태 | 근거 파일 | 난이도 | Phase |
|------|----------|----------|--------|-------|
| 채팅 푸시 | ⚠️ | FCM 템플릿만 | M | 1 |
| 공지 푸시 | ❌ | - | L | 1 |
| 펀딩 업데이트 푸시 | ❌ | - | L | 1 |
| 정산 이벤트 푸시 | ❌ | - | L | 1 |
| 딥링크 | ❌ | - | M | 1 |
| 뱃지 카운트 | ❌ | - | L | 1 |
| 방해금지 모드 | ❌ | - | L | 2 |

---

## B. 크리에이터 수익화/CRM

### B.1 대시보드/분석

| 기능 | 현재 상태 | 근거 파일 | 난이도 | Phase |
|------|----------|----------|--------|-------|
| 매출 개요 | ✅ | `creator_dashboard_screen.dart` | - | - |
| ARPPU | ⚠️ | 데모 데이터만 | M | 2 |
| 리텐션 | ⚠️ | 데모 데이터만 | M | 2 |
| 재구매율 | ❌ | - | M | 2 |
| 구독자 추이 | ✅ | `creator_analytics_screen.dart` | - | - |
| 팬 세그먼트 | ⚠️ | CRM 탭에 기본 구현 | M | 2 |

### B.2 캠페인 성과

| 기능 | 현재 상태 | 근거 파일 | 난이도 | Phase |
|------|----------|----------|--------|-------|
| 전환 퍼널 | ❌ | - | H | 2 |
| 리워드별 성과 | ❌ | - | M | 2 |
| 환불률/차지백 | ❌ | - | M | 2 |

### B.3 팬 관리

| 기능 | 현재 상태 | 근거 파일 | 난이도 | Phase |
|------|----------|----------|--------|-------|
| 등급/배지 | ⚠️ | 구독 티어로 표시 | L | 1 |
| 1:1 메시지 | ⚠️ | `creator_dm_screen.dart` | L | 1 |
| 1:N 공지 발송 | ✅ | `broadcast_compose_screen.dart` | - | - |
| 혐오/스팸 필터링 | ❌ | - | H | 2 |

### B.4 정산

| 기능 | 현재 상태 | 근거 파일 | 난이도 | Phase |
|------|----------|----------|--------|-------|
| 정산 상태 (예정/진행/완료/보류) | ⚠️ | Edge Function 있음 | M | 1 |
| 정산서 다운로드 | ⚠️ | `payout-statement/index.ts` | L | 1 |
| 세금계산/원천징수 플래그 | ❌ | - | M | 2 |

---

## C. 펀딩 (와디즈/텀블벅/메이크스타형)

### C.1 공개 웹

| 기능 | 현재 상태 | 근거 파일 | 난이도 | Phase |
|------|----------|----------|--------|-------|
| 캠페인 목록 | ✅ | `funding_screen.dart` | - | - |
| 캠페인 상세 | ✅ | `funding_detail_screen.dart` | - | - |
| 프리런치 페이지 | ❌ | - | M | 2 |
| OG 태그 | ❌ | Next.js에서 처리 필요 | L | 1 |
| JSON-LD | ❌ | - | L | 1 |
| SEO 최적화 | ❌ | - | M | 1 |

### C.2 크리에이터 스튜디오

| 기능 | 현재 상태 | 근거 파일 | 난이도 | Phase |
|------|----------|----------|--------|-------|
| 캠페인 생성 | ✅ | `create_campaign_screen.dart` | - | - |
| 스토리 에디터 | ⚠️ | 기본 텍스트만 | M | 2 |
| 티어/리워드 설정 | ✅ | `funding_tier_select_screen.dart` | - | - |
| FAQ 관리 | ❌ | - | L | 2 |
| 심사 제출 | ❌ | - | M | 1 |
| 미리보기 | ⚠️ | 제한적 | L | 1 |

### C.3 어드민

| 기능 | 현재 상태 | 근거 파일 | 난이도 | Phase |
|------|----------|----------|--------|-------|
| 캠페인 승인/반려 | ❌ | - | H | 1 |
| 수정요청 | ❌ | - | M | 1 |
| 신고 트리아지 | ❌ | - | H | 1 |
| 환불 처리 | ❌ | - | H | 1 |
| 감사 추적 | ⚠️ | `admin_audit_log` 테이블 있음 | M | 1 |

### C.4 결제/환불

| 기능 | 현재 상태 | 근거 파일 | 난이도 | Phase |
|------|----------|----------|--------|-------|
| 결제 성공 | ⚠️ | 웹훅 구현됨 | M | 1 |
| 결제 실패 처리 | ❌ | - | M | 1 |
| 재시도 로직 | ❌ | - | M | 1 |
| 웹훅 Idempotency | ✅ | `payment-webhook/index.ts` | - | - |
| 환불 정책 적용 | ❌ | - | H | 1 |

### C.5 리워드/배송

| 기능 | 현재 상태 | 근거 파일 | 난이도 | Phase |
|------|----------|----------|--------|-------|
| 리워드 옵션 | ✅ | `funding_tier_select_screen.dart` | - | - |
| 주소 수집 | ❌ | - | M | 2 |
| 배송 상태 | 🔮 | - | H | 2 |

---

## D. 라이브 스트리밍 (설계만)

> Phase 2 이후 구현. 현재는 비용 변수 정의만 수행.

### D.1 비용 결정 변수

| 변수 | 설명 | 추정 범위 |
|------|------|----------|
| 동시 시청자 수 | 피크 타임 CCU | 100~10,000 |
| 스트리밍 해상도 | 720p/1080p | bitrate 의존 |
| 평균 시청 시간 | 분 단위 | 10~60분 |
| 월간 총 방송 시간 | 크리에이터당 | 10~100시간 |
| 녹화 보관 일수 | VOD 저장 기간 | 7~90일 |
| CDN 트래픽 | GB/월 | 계산 필요 |

### D.2 기술 옵션 비교

| 옵션 | 장점 | 단점 | 비용 모델 |
|------|------|------|----------|
| AWS IVS | AWS 통합, 저지연 | 고비용 | $0.0034/분 + CDN |
| Agora | 저지연, SDK 우수 | 국내 지원 약함 | MAU 기반 |
| WebRTC (직접) | 저비용, 제어권 | 개발 복잡도 높음 | 인프라만 |
| MediaSoup | 오픈소스, 확장성 | 운영 복잡도 | 인프라만 |
| Twitch 임베드 | 무료 | 브랜딩 제한 | 무료 |

---

## E. 보안/개인정보/결제

### E.1 RLS 현황

| 테이블 | RLS | SELECT | INSERT | UPDATE | DELETE | 이슈 |
|--------|-----|--------|--------|--------|--------|------|
| channels | ✅ | ✅ | ✅ | ✅ | - | - |
| subscriptions | ✅ | ✅ | ✅ | ✅ | - | - |
| messages | ✅ | ✅ | ✅ | ✅ | - | - |
| reply_quota | ✅ | ✅ | ✅ | ✅ | - | - |
| wallets | ✅ | ✅ | ✅ | ✅ | - | - |
| ledger_entries | ✅ | ✅ | ✅ | - | - | - |
| creator_payout_accounts | ✅ | ✅ | ✅ | ✅ | - | - |
| **admin_audit_log** | ✅ | ✅ | ⚠️ | - | - | **INSERT 누구나 가능** |

### E.2 암호화

| 항목 | 상태 | 방식 | 이슈 |
|------|------|------|------|
| 계좌번호 | ✅ | AES-256-GCM | fallback 키 하드코딩 |
| 주민번호 | ✅ | AES-256-GCM | fallback 키 하드코딩 |
| 키 로테이션 | ⚠️ | 지원됨 | 절차 문서화 필요 |

### E.3 결제 보안

| 항목 | 상태 | 근거 |
|------|------|------|
| 웹훅 서명검증 | ✅ | HMAC-SHA256 |
| 타이밍 안전 비교 | ✅ | `timingSafeEqual` |
| Idempotency | ✅ | `payment_webhook_logs` |
| Rate Limiting | ❌ | 미구현 |

---

## F. 운영/모더레이션

### F.1 어드민 기능

| 기능 | 현재 상태 | 난이도 | Phase |
|------|----------|--------|-------|
| 어드민 대시보드 | ❌ | H | 1 |
| 캠페인 심사 큐 | ❌ | H | 1 |
| 신고 트리아지 | ❌ | H | 1 |
| 사용자 제재 | ⚠️ | `isBanned` 필드만 | M | 1 |
| 감사로그 조회 | ⚠️ | 테이블만 | L | 1 |
| 환불 처리 | ❌ | H | 1 |

### F.2 자동 모더레이션

| 기능 | 현재 상태 | 난이도 | Phase |
|------|----------|--------|-------|
| 스팸 필터 | ❌ | M | 2 |
| 욕설 필터 | ❌ | M | 2 |
| 이미지 검수 | 🔮 | H | 2 |
| 자동 제재 트리거 | ❌ | H | 2 |

---

## G. 법무/세무 체크리스트

| 항목 | 필요 여부 | 현재 상태 | Phase |
|------|----------|----------|-------|
| 서비스 이용약관 | 필수 | ❌ | 0 |
| 개인정보처리방침 | 필수 | ❌ | 0 |
| 청약철회/환불 정책 | 필수 | ❌ | 0 |
| 커뮤니티 가이드라인 | 권장 | ❌ | 1 |
| 정산 정책 고지 | 필수 | ❌ | 1 |
| 연령 제한 고지 | 필수 | ⚠️ 구현됨, 약관 없음 | 1 |

---

## Phase 분류 요약

### Phase 0 (즉시 - 1-2일)
- 암호화 키 fallback 제거
- 감사로그 INSERT 정책 수정
- 서비스 이용약관/개인정보처리방침 초안

### Phase 1 (런칭 전 - 1-2주)
- 메시지 편집/삭제 UI
- 신고/차단 기능
- 푸시 알림 구현
- 어드민 MVP (승인/반려/신고처리)
- 결제 연동 완료

### Phase 2 (런칭 후 - 1개월)
- 고급 메시지 기능 (답장, 인용, 멘션)
- 자동 모더레이션
- 분석 고도화
- 라이브 스트리밍 설계
- 국제화
