# UNO A Marketing Communication Rules

> **문서 버전**: 1.0
> **적용 법규**: 정보통신망법, 개인정보보호법, 전자상거래법

---

## 1. 알림 유형 분류

| 유형 | 정의 | 동의 필요 | 예시 |
|------|------|:--------:|------|
| **트랜잭션 알림** | 사용자가 요청한 거래/서비스에 직접 관련 | ❌ | 결제 확인, 구독 갱신, 비밀번호 변경, 계정 보안 |
| **서비스 알림** | 서비스 운영에 필수적인 공지 | ❌ | 약관 변경, 시스템 점검, 정책 업데이트 |
| **마케팅 알림** | 상업적 목적의 광고/프로모션 | ✅ **사전 동의** | 이벤트, 할인, 추천 아티스트, 프로모션 |

---

## 2. consent_type 매핑

DB 테이블 `user_consents` (migration 018):

| consent_type | 설명 | 채널 |
|-------------|------|------|
| `marketing_email` | 마케팅 이메일 수신 | Email |
| `marketing_push` | 마케팅 푸시 알림 수신 | FCM Push |
| `marketing_sms` | 마케팅 SMS 수신 | SMS |
| `third_party_sharing` | 제3자 정보 제공 | - |

### Flutter UI 매핑 (settings_screen.dart)

```dart
const _consentTypeMapping = {
  '마케팅 이메일': 'marketing_email',
  '마케팅 푸시': 'marketing_push',
  '마케팅 SMS': 'marketing_sms',
  '제3자 제공': 'third_party_sharing',
};
```

---

## 3. 동의 수집 원칙

### 3.1 사전 동의 (Opt-in)

- 마케팅 알림은 **명시적 사전 동의** 후에만 발송
- 동의 시점에 `version` 필드로 약관 버전 기록 (`BusinessConfig.currentConsentVersion`)
- 동의 UI에서 각 채널별 **개별 동의** 수집 (일괄 동의 불가)

### 3.2 철회 (Opt-out)

- 옵트아웃은 **즉시 반영** (다음 발송부터 적용)
- 철회 시 `revoked_at` 타임스탬프 기록
- `consent_history` 트리거가 자동으로 변경 이력 저장 (migration 018)
- 철회 후 **48시간 이내** 모든 큐잉된 마케팅 메시지 취소

### 3.3 재동의

- `BusinessConfig.currentConsentVersion` 변경 시 (약관 개정)
- 기존 동의는 이전 버전으로 남고, 새 버전에 대한 재동의 유도
- 재동의 전까지 해당 채널 마케팅 발송 중단

---

## 4. 발송 제한

### 4.1 야간 발송 금지

| 구분 | 시간 (KST) | 허용 여부 |
|------|-----------|:--------:|
| 주간 | 08:00 ~ 21:00 | ✅ |
| 야간 | 21:00 ~ 08:00 | ❌ (마케팅만) |

- 트랜잭션/서비스 알림은 야간에도 발송 가능
- `scheduled-dispatcher` Edge Function에서 KST 시간 체크

### 4.2 빈도 제한

| 채널 | 최대 빈도 | 비고 |
|------|----------|------|
| Push | 1일 3회 | 트랜잭션 알림 제외 |
| Email | 주 2회 | 트랜잭션 알림 제외 |
| SMS | 월 2회 | 트랜잭션 알림 제외 |

---

## 5. 수신 거부 안내 의무

모든 마케팅 메시지에 포함:

- **Push**: 설정 > 알림 설정에서 수신 거부 가능 안내
- **Email**: 하단에 "수신 거부" 링크 (1-클릭 옵트아웃)
- **SMS**: `무료거부 080-xxx-xxxx` 또는 `수신거부` 회신 안내

---

## 6. 증빙 및 감사

### 저장 항목

- 동의 시점 (`agreed_at`)
- 철회 시점 (`revoked_at`)
- 동의 버전 (`version`)
- 변경 이력 (`consent_history` 테이블, 트리거 자동 기록)

### 보존 기간

- 동의 기록: **서비스 이용 기간 + 3년** (전자상거래법)
- 마케팅 발송 로그: **6개월** (개인정보보호법)

---

## 7. 법적 참조

| 법규 | 조항 | 요약 |
|------|------|------|
| 정보통신망법 제50조 | 영리 목적 광고 전송 제한 | 사전 동의, 야간 금지, 수신 거부 |
| 개인정보보호법 제22조 | 동의 수집 방법 | 개별 동의, 명확한 고지 |
| 전자상거래법 제13조 | 소비자 정보 제공 | 사업자 정보, 환불 안내 |
