# UNOA Ops 프로세스 가이드 (신입자용)

> 이 문서를 5분 읽으면 전체 운영 프로세스를 파악할 수 있습니다.

---

## 1. 전체 흐름도

```
 사용자 요청
     │
     ▼
┌─────────┐     ┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│ /route  │────▶│ Gate 산출물  │────▶│   Builder    │────▶│  검증/배포   │
│         │     │  생성        │     │   구현       │     │              │
└─────────┘     └──────────────┘     └──────────────┘     └──────────────┘
     │               │                     │                     │
     ▼               ▼                     ▼                     ▼
 ┌────────┐    ┌──────────┐         ┌──────────┐         ┌──────────┐
 │Notion  │    │ Slack    │         │  Git PR  │         │ /qa      │
 │WI 생성 │    │ Thread에 │         │  (작은   │         │ /verify  │
 │        │    │ 게시     │         │   단위)  │         │ /ship    │
 └────────┘    └──────────┘         └──────────┘         └──────────┘
```

### 핵심 공식

```
╔═══════════════════════════════════════════════════════════╗
║  WI 1개 = Slack 스레드 1개 = PR 1개                       ║
║  Gate 산출물 없이는 구현 불가                               ║
║  Builder만 코드를 수정할 수 있다                            ║
╚═══════════════════════════════════════════════════════════╝
```

---

## 2. 상태 전이도

```
┌────────┐     ┌────────┐     ┌──────────────┐     ┌─────────┐
│ Intake │────▶│ Routed │────▶│Gates Pending │────▶│ Blocked │
└────────┘     └────────┘     └──────┬───────┘     └────┬────┘
                                     │                   │
                                     │    (블로커 해결)   │
                                     │◀──────────────────┘
                                     ▼
                              ┌──────────────┐     ┌────────┐
                              │Builder       │────▶│ Review │
                              │Working       │     └───┬────┘
                              └──────────────┘         │
                                                       ▼
                              ┌──────────────┐     ┌────────┐
                              │    Done      │◀────│Ready to│
                              │              │     │Ship    │
                              └──────┬───────┘     └────────┘
                                     │
                                     ▼
                              ┌──────────────┐
                              │  Archived    │
                              └──────────────┘
```

---

## 3. 역할별 권한 매트릭스

```
             │ 코드수정 │ Gate산출 │ 라우팅 │ 커밋/PR │ 배포승인 │
─────────────┼──────────┼─────────┼────────┼─────────┼──────────│
Orchestrator │    ❌    │   지정   │   ✅   │   ❌    │   ❌    │
Security     │    ❌    │   ✅    │   ❌   │   ❌    │   ❌    │
UIUX/Obs     │    ❌    │   ✅    │   ❌   │   ❌    │   ❌    │
Legal        │    ❌    │   ✅    │   ❌   │   ❌    │   ❌    │
Tax          │    ❌    │   ✅    │   ❌   │   ❌    │   ❌    │
Builder      │    ✅    │   ❌    │   ❌   │   ✅    │   ❌    │
─────────────┴──────────┴─────────┴────────┴─────────┴──────────┘

✅ = 허용  ❌ = 금지
```

---

## 4. 5분 퀵스타트

### Step 1: 작업 시작 → `/route`
```
"새 결제 흐름을 추가하고 싶어요"
→ /route 실행
→ Notion WI 자동 생성 + Slack 스레드 자동 생성
→ 필요한 Gate 자동 지정: [security, legal, tax, uiux_obs]
```

### Step 2: Gate 산출물 확인
```
/security_gate  → 보안/DB 블로커 + 요구사항
/uiux_obs_gate  → 실패 UX 정책 + 로깅 규칙
/legal_gate     → 약관/표시 의무 체크리스트
/tax_gate       → 거래흐름/증빙 요구사항
```

### Step 3: Builder 구현
```
Gate 산출물의 Blockers/Required를 반영하여 구현
→ 작은 PR (1 WI = 1 PR)
→ PR template에 WI/Slack/Gate 체크
```

### Step 4: 검증 → 배포
```
/qa      → 테스트/린트/빌드 실행
/verify  → 최종 규정 준수 체크
/ship    → Notion 마감 + Slack 공지 + 배포
```

---

## 5. Gate 산출물 포맷 (공통)

모든 Gate는 동일한 포맷으로 산출물을 만듭니다:

```
## Blockers (P0/P1 — 이것 없으면 출시 불가)
- ...

## Required (반드시 해야 하는 변경/정책)
- ...

## Nice-to-have (선택 개선)
- ...

## Evidence (근거 — 어떤 파일/규칙/화면 때문에)
- ...

## Risk Rating: P0 ~ P3
```

---

## 6. 커맨드 요약표

| 커맨드 | 언제 사용 | 누가 실행 |
|--------|-----------|-----------|
| `/route` | 작업 시작 시 | 누구나 |
| `/security_gate` | 보안/DB 검토 필요 시 | Orchestrator |
| `/uiux_obs_gate` | UX/로그 검토 필요 시 | Orchestrator |
| `/legal_gate` | 법무 검토 필요 시 | Orchestrator |
| `/tax_gate` | 세무 검토 필요 시 | Orchestrator |
| `/qa` | 구현 완료 후 | Builder |
| `/verify` | 배포 전 | Builder |
| `/ship` | 배포 시 | Builder |

---

## 7. FAQ

### Q: Gate를 건너뛸 수 있나요?
A: 네, 단 "면제 사유"를 Notion WI와 PR에 명시해야 합니다. 예: "문서만 변경, 보안 영향 없음"

### Q: PR이 너무 큰데요?
A: 1 PR = 1 WI 원칙. WI를 더 작게 쪼개세요. 기능+리팩토링 섞지 않기.

### Q: 급한 핫픽스는?
A: `#ops-incidents`에 선언 → 인시던트 런북 따르기 → 사후에 WI 생성하고 Gate 보완.

### Q: Slack 스레드가 너무 길어졌어요.
A: 결정 사항만 Notion WI의 "결정 로그"에 정리. 스레드는 논의용.

### Q: 비밀키를 실수로 커밋했어요!
A: 즉시 키 폐기/재발급 → `git rebase` / BFG로 히스토리 정리 → `#ops-incidents` 보고.

---

## 8. 관련 문서

| 문서 | 위치 |
|------|------|
| 운영 계약서 | `CLAUDE.md` |
| Notion 구조 | `ops/workflow/notion.md` |
| Slack 구조 | `ops/workflow/slack.md` |
| 부트스트랩 | `ops/workflow/bootstrap.md` |
| 인시던트 런북 | `ops/runbooks/incident.md` |
| 결제 런북 | `ops/runbooks/payments.md` |
| 마이그레이션 런북 | `ops/runbooks/migrations.md` |
