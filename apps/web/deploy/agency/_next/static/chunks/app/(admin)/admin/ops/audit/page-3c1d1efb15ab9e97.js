(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6856],{244:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var r=a(5155),n=a(2115),s=a(3581),i=a(508),o=a(6983),l=a(9630);let d={"banner.create":"배너 생성","banner.update":"배너 수정","banner.submit_review":"검수 요청","banner.publish":"배너 게시","banner.rollback":"배너 롤백","banner.archive":"배너 보관","flag.create":"플래그 생성","flag.update":"플래그 수정","flag.publish":"플래그 게시","flag.rollback":"플래그 롤백","asset.upload":"에셋 업로드","asset.delete":"에셋 삭제","staff.create":"스태프 추가","staff.update":"스태프 수정","staff.remove":"스태프 삭제","settlement.approve":"정산 승인","settlement.reject":"정산 반려","creator.warn":"크리에이터 경고","creator.suspend":"크리에이터 정지","report.review":"신고 검토 시작","report.resolve":"신고 해결","report.dismiss":"신고 기각","payment.refund":"결제 환불"};function c(e){let{before:t,after:a}=e;if(!t&&!a)return null;let n=new Set;return(t&&Object.keys(t).forEach(e=>n.add(e)),a&&Object.keys(a).forEach(e=>n.add(e)),0===n.size)?null:(0,r.jsx)("div",{className:"mt-2 p-2 bg-gray-50 rounded text-xs font-mono space-y-1",children:Array.from(n).map(e=>(0,r.jsxs)("div",{children:[(0,r.jsxs)("span",{className:"text-gray-500",children:[e,": "]}),(null==t?void 0:t[e])!==void 0&&(0,r.jsx)("span",{className:"bg-red-50 text-red-700 line-through px-1 rounded mr-1",children:JSON.stringify(t[e])}),(null==a?void 0:a[e])!==void 0&&(0,r.jsx)("span",{className:"bg-green-50 text-green-700 px-1 rounded",children:JSON.stringify(a[e])})]},e))})}function u(){let[e,t]=(0,n.useState)([]),[a,u]=(0,n.useState)(0),[p,f]=(0,n.useState)(!0),[m,_]=(0,n.useState)(""),[y,h]=(0,n.useState)(0);return(0,n.useEffect)(()=>{!async function(){f(!0);try{let e=await (0,l._v)({entity_type:m||void 0,limit:20,offset:20*y});t(e.items),u(e.total)}catch(e){}finally{f(!1)}}()},[m,y]),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"감사 로그"}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(s.A,{className:"w-4 h-4 text-gray-400"}),(0,r.jsxs)("select",{className:"text-sm border border-gray-300 rounded-lg px-3 py-2",value:m,onChange:e=>{_(e.target.value),h(0)},children:[(0,r.jsx)("option",{value:"",children:"모든 유형"}),(0,r.jsx)("option",{value:"ops_banners",children:"배너"}),(0,r.jsx)("option",{value:"ops_feature_flags",children:"플래그"}),(0,r.jsx)("option",{value:"ops_assets",children:"에셋"}),(0,r.jsx)("option",{value:"ops_staff",children:"스태프"}),(0,r.jsx)("option",{value:"settlements",children:"정산"}),(0,r.jsx)("option",{value:"creators",children:"크리에이터"}),(0,r.jsx)("option",{value:"reports",children:"신고"}),(0,r.jsx)("option",{value:"payments",children:"결제"})]}),(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:["총 ",a,"건"]})]}),p?(0,r.jsx)("div",{className:"space-y-3",children:Array.from({length:5}).map((e,t)=>(0,r.jsx)("div",{className:"h-20 bg-gray-100 rounded-lg animate-pulse"},t))}):0===e.length?(0,r.jsx)("p",{className:"text-sm text-gray-500 text-center py-12",children:"로그가 없습니다."}):(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"absolute left-4 top-0 bottom-0 w-0.5 bg-gray-200"}),(0,r.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,r.jsxs)("div",{className:"relative pl-10",children:[(0,r.jsx)("div",{className:"absolute left-2.5 top-2 w-3 h-3 rounded-full bg-blue-500 border-2 border-white"}),(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-900",children:d[e.action]||e.action}),e.entity_id&&(0,r.jsxs)("span",{className:"ml-2 text-xs text-gray-400 font-mono",children:[e.entity_id.slice(0,8),"..."]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-500 shrink-0",children:[(0,r.jsx)(i.A,{className:"w-3 h-3"}),(0,r.jsx)("span",{children:e.actor_role}),(0,r.jsx)(o.A,{className:"w-3 h-3 ml-1"}),(0,r.jsx)("span",{children:new Date(e.created_at).toLocaleString("ko-KR")})]})]}),(0,r.jsx)(c,{before:e.before,after:e.after})]})]},e.id))})]}),a>20&&(0,r.jsxs)("div",{className:"flex justify-center gap-2",children:[(0,r.jsx)("button",{className:"px-3 py-1 text-sm border rounded disabled:opacity-30",disabled:0===y,onClick:()=>h(y-1),children:"이전"}),(0,r.jsxs)("span",{className:"px-3 py-1 text-sm text-gray-600",children:[y+1," / ",Math.ceil(a/20)]}),(0,r.jsx)("button",{className:"px-3 py-1 text-sm border rounded disabled:opacity-30",disabled:(y+1)*20>=a,onClick:()=>h(y+1),children:"다음"})]})]})}},508:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(1847).A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},1847:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var r=a(2115);let n=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim()};var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,r.forwardRef)((e,t)=>{let{color:a="currentColor",size:i=24,strokeWidth:o=2,absoluteStrokeWidth:l,className:d="",children:c,iconNode:u,...p}=e;return(0,r.createElement)("svg",{ref:t,...s,width:i,height:i,stroke:a,strokeWidth:l?24*Number(o)/Number(i):o,className:n("lucide",d),...p},[...u.map(e=>{let[t,a]=e;return(0,r.createElement)(t,a)}),...Array.isArray(c)?c:[c]])}),o=(e,t)=>{let a=(0,r.forwardRef)((a,s)=>{let{className:o,...l}=a;return(0,r.createElement)(i,{ref:s,iconNode:t,className:n("lucide-".concat(e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),o),...l})});return a.displayName="".concat(e),a}},3581:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(1847).A)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]])},3723:(e,t,a)=>{Promise.resolve().then(a.bind(a,244))},6983:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(1847).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},9630:(e,t,a)=>{"use strict";a.d(t,{AO:()=>_,E3:()=>N,FR:()=>m,LO:()=>j,WR:()=>x,Xo:()=>v,Zt:()=>g,_v:()=>S,cQ:()=>b,cb:()=>u,g8:()=>T,j$:()=>h,jB:()=>k,jd:()=>p,lA:()=>c,ny:()=>A,qs:()=>f,s1:()=>y,tV:()=>Z,wx:()=>C,yZ:()=>E,zU:()=>w});var r=a(5417),n=a(7376),s=a(5704);let i=[{id:"demo-banner-1",title:"신규 아티스트 오픈 기념 이벤트",placement:"home_top",image_url:"https://picsum.photos/seed/banner1/800/400",link_url:"/discover",link_type:"internal",status:"published",priority:10,start_at:null,end_at:null,target_audience:"all",version:2,published_snapshot:null,created_by:"demo-ops-1",updated_by:"demo-ops-1",created_at:"2025-12-01T00:00:00Z",updated_at:"2025-12-10T00:00:00Z"},{id:"demo-banner-2",title:"VIP 전용 특별 혜택",placement:"home_bottom",image_url:"https://picsum.photos/seed/banner2/800/400",link_url:"/subscriptions",link_type:"internal",status:"draft",priority:5,start_at:null,end_at:null,target_audience:"vip",version:1,published_snapshot:null,created_by:"demo-ops-1",updated_by:null,created_at:"2025-12-15T00:00:00Z",updated_at:"2025-12-15T00:00:00Z"}],o=[{id:"demo-flag-1",flag_key:"dark_mode_v2",title:"다크 모드 v2",description:"새로운 다크 모드 디자인 테스트",status:"published",enabled:!0,rollout_percent:50,payload:{variant:"new_palette"},version:3,published_snapshot:null,created_by:"demo-ops-1",updated_by:"demo-ops-1",created_at:"2025-11-01T00:00:00Z",updated_at:"2025-12-05T00:00:00Z"},{id:"demo-flag-2",flag_key:"gift_feature",title:"선물 기능",description:"팬 간 선물 전송 기능",status:"draft",enabled:!1,rollout_percent:0,payload:{},version:1,published_snapshot:null,created_by:"demo-ops-1",updated_by:null,created_at:"2025-12-20T00:00:00Z",updated_at:"2025-12-20T00:00:00Z"}],l=[{id:"demo-audit-1",actor_id:"demo-ops-1",actor_role:"publisher",action:"banner.publish",entity_type:"ops_banners",entity_id:"demo-banner-1",before:{status:"in_review"},after:{status:"published"},metadata:{},created_at:"2025-12-10T14:30:00Z"},{id:"demo-audit-2",actor_id:"demo-ops-1",actor_role:"operator",action:"flag.create",entity_type:"ops_feature_flags",entity_id:"demo-flag-2",before:null,after:{flag_key:"gift_feature",title:"선물 기능"},metadata:{},created_at:"2025-12-20T09:00:00Z"},{id:"demo-audit-3",actor_id:"demo-ops-2",actor_role:"admin",action:"settlement.approve",entity_type:"settlements",entity_id:"settlement-2026-01-waker",before:{status:"pending"},after:{status:"approved",title:"WAKER 2026-01월 정산 승인"},metadata:{artist_name:"WAKER",period:"2026-01"},created_at:"2026-02-05T10:15:00Z"},{id:"demo-audit-4",actor_id:"demo-ops-2",actor_role:"admin",action:"settlement.reject",entity_type:"settlements",entity_id:"settlement-2026-01-moonlight",before:{status:"pending"},after:{status:"rejected",reason:"서류 미비",title:"MOONLIGHT 정산 반려 (서류 미비)"},metadata:{artist_name:"MOONLIGHT",period:"2026-01"},created_at:"2026-02-07T14:22:00Z"},{id:"demo-audit-5",actor_id:"demo-ops-3",actor_role:"moderator",action:"creator.warn",entity_type:"creators",entity_id:"creator-starlight",before:{warning_count:0},after:{warning_count:1,title:"크리에이터 '별빛' 경고 발송"},metadata:{reason:"부적절한 콘텐츠 게시"},created_at:"2026-02-08T16:45:00Z"},{id:"demo-audit-6",actor_id:"demo-ops-3",actor_role:"moderator",action:"creator.suspend",entity_type:"creators",entity_id:"creator-baduser",before:{status:"active"},after:{status:"suspended",title:"크리에이터 '악성유저' 정지 처리"},metadata:{reason:"약관 위반 (중복)",duration_days:30},created_at:"2026-02-10T11:30:00Z"},{id:"demo-audit-7",actor_id:"demo-ops-4",actor_role:"moderator",action:"report.resolve",entity_type:"reports",entity_id:"rpt-002",before:{status:"reviewing"},after:{status:"resolved",title:"신고 #rpt-002 해결 처리",action_taken:"경고 발송"},metadata:{report_type:"harassment"},created_at:"2026-02-11T09:18:00Z"},{id:"demo-audit-8",actor_id:"demo-ops-5",actor_role:"operator",action:"payment.refund",entity_type:"payments",entity_id:"pay-007",before:{status:"completed"},after:{status:"refunded",title:"펀딩 결제 환불 처리 (#pay-007)",amount:9900},metadata:{reason:"고객 요청",refund_method:"original"},created_at:"2026-02-12T13:50:00Z"}];async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=function(){let e=s.env.NEXT_PUBLIC_SUPABASE_URL||"",t=s.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"";return(0,r.createBrowserClient)(e,t)}(),{data:{session:n}}=await a.auth.getSession();if(!(null==n?void 0:n.access_token))throw Error("인증이 필요합니다. 다시 로그인해주세요.");let i="".concat(s.env.NEXT_PUBLIC_SUPABASE_URL,"/functions/v1/ops-manage"),o=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n.access_token)},body:JSON.stringify({action:e,payload:t})}),l=await o.json();if(!l.success)throw Error(l.error||"요청 실패 (".concat(o.status,")"));return l.data}async function c(){return n.Gc?[]:d("staff.list")}async function u(e,t,a){return d("staff.upsert",{target_user_id:e,role:t,display_name:a})}async function p(e){await d("staff.remove",{target_user_id:e})}async function f(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.Gc?{items:[],total:0}:d("asset.list",e)}async function m(e){return d("asset.upload_complete",e)}async function _(e){await d("asset.delete",{id:e})}async function y(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.Gc?i:d("banner.list",e)}async function h(e){if(n.Gc){let t=i.find(t=>t.id===e);if(!t)throw Error("배너를 찾을 수 없습니다");return t}return d("banner.get",{id:e})}async function g(e){return n.Gc?{...i[0],...e,id:"demo-banner-".concat(Date.now()),status:"draft",version:1}:d("banner.create",{...e})}async function b(e,t,a){if(n.Gc){let r=i.find(t=>t.id===e);if(!r)throw Error("배너를 찾을 수 없습니다");return{...r,...a,version:t+1}}return d("banner.update",{id:e,expected_version:t,...a})}async function v(e,t){return d("banner.submit_review",{id:e,expected_version:t})}async function x(e,t){return d("banner.publish",{id:e,expected_version:t})}async function j(e){return d("banner.rollback",{id:e})}async function w(e,t){return d("banner.archive",{id:e,expected_version:t})}async function N(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.Gc?o:d("flag.list",e)}async function k(e){if(n.Gc){let t=o.find(t=>t.id===e);if(!t)throw Error("플래그를 찾을 수 없습니다");return t}return d("flag.get",{id:e})}async function A(e){return n.Gc?{...o[0],...e,payload:e.payload_data,id:"demo-flag-".concat(Date.now()),status:"draft",version:1}:d("flag.create",{...e})}async function E(e,t,a){if(n.Gc){let r=o.find(t=>t.id===e);if(!r)throw Error("플래그를 찾을 수 없습니다");return{...r,...a,version:t+1}}return d("flag.update",{id:e,expected_version:t,...a})}async function T(e,t){return d("flag.publish",{id:e,expected_version:t})}async function Z(e){return d("flag.rollback",{id:e})}async function S(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.Gc?{items:l,total:l.length}:d("audit.list",e)}async function C(){if(n.Gc)return{activeBanners:i.filter(e=>"published"===e.status).length,activeFlags:o.filter(e=>"published"===e.status).length,pendingReview:i.filter(e=>"in_review"===e.status).length,recentChanges:l.slice(0,5)};let[e,t,a]=await Promise.all([y(),N(),S({limit:5})]);return{activeBanners:e.filter(e=>"published"===e.status).length,activeFlags:t.filter(e=>"published"===e.status).length,pendingReview:e.filter(e=>"in_review"===e.status).length,recentChanges:a.items}}}},e=>{e.O(0,[5417,7376,8441,1255,7358],()=>e(e.s=3723)),_N_E=e.O()}]);