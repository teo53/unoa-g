(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1524],{884:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>y});var r=a(5155),n=a(2115),s=a(2619),i=a.n(s),l=a(6132),o=a(2196),d=a(4347),c=a(6983),u=a(2987),m=a(9630);let p={"banner.create":"배너 생성","banner.update":"배너 수정","banner.submit_review":"검수 요청","banner.publish":"배너 게시","banner.rollback":"배너 롤백","banner.archive":"배너 보관","flag.create":"플래그 생성","flag.update":"플래그 수정","flag.publish":"플래그 게시","flag.rollback":"플래그 롤백","asset.upload":"에셋 업로드","staff.create":"스태프 추가"};function h(e){let{label:t,value:a,icon:n,href:s,color:l}=e;return(0,r.jsx)(i(),{href:s,className:"bg-white border border-gray-200 rounded-xl p-6 hover:shadow-md transition-shadow",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:t}),(0,r.jsx)("p",{className:"text-3xl font-bold mt-1",children:a})]}),(0,r.jsx)("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center ".concat(l),children:(0,r.jsx)(n,{className:"w-6 h-6 text-white"})})]})})}function f(e){let{entry:t}=e;return(0,r.jsxs)("div",{className:"flex items-center gap-3 py-3 border-b border-gray-100 last:border-0",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full bg-blue-500 shrink-0"}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"text-sm text-gray-900 truncate",children:p[t.action]||t.action}),(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:[t.actor_role," \xb7"," ",new Date(t.created_at).toLocaleString("ko-KR")]})]})]})}function y(){var e,t,a;let[s,p]=(0,n.useState)(null),[y,g]=(0,n.useState)(!0),[_,x]=(0,n.useState)(null);return((0,n.useEffect)(()=>{!async function(){try{let e=await (0,m.wx)();p(e)}catch(e){x(e instanceof Error?e.message:"데이터를 불러올 수 없습니다")}finally{g(!1)}}()},[]),y)?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Ops 대시보드"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[1,2,3].map(e=>(0,r.jsx)("div",{className:"h-28 bg-gray-100 rounded-xl animate-pulse"},e))})]}):_?(0,r.jsxs)("div",{className:"flex flex-col items-center gap-4 py-12",children:[(0,r.jsx)(l.A,{className:"w-12 h-12 text-red-400"}),(0,r.jsx)("p",{className:"text-gray-600",children:_}),(0,r.jsx)("button",{className:"text-sm text-blue-600 underline",onClick:()=>window.location.reload(),children:"다시 시도"})]}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Ops 대시보드"})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsx)(h,{label:"활성 배너",value:null!=(e=null==s?void 0:s.activeBanners)?e:0,icon:o.A,href:"/admin/ops/banners?status=published",color:"bg-blue-500"}),(0,r.jsx)(h,{label:"활성 플래그",value:null!=(t=null==s?void 0:s.activeFlags)?t:0,icon:d.A,href:"/admin/ops/flags?status=published",color:"bg-green-500"}),(0,r.jsx)(h,{label:"검수 대기",value:null!=(a=null==s?void 0:s.pendingReview)?a:0,icon:c.A,href:"/admin/ops/banners?status=in_review",color:"bg-yellow-500"})]}),(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,r.jsx)("h2",{className:"font-semibold text-gray-900",children:"최근 변경"}),(0,r.jsxs)(i(),{href:"/admin/ops/audit",className:"text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1",children:["전체 보기 ",(0,r.jsx)(u.A,{className:"w-3 h-3"})]})]}),(0,r.jsx)("div",{className:"p-4",children:(null==s?void 0:s.recentChanges)&&s.recentChanges.length>0?s.recentChanges.map(e=>(0,r.jsx)(f,{entry:e},e.id)):(0,r.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"아직 변경 이력이 없습니다."})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)(i(),{href:"/admin/ops/banners/new",className:"flex items-center gap-3 p-4 bg-white border border-gray-200 rounded-xl hover:shadow-md transition-shadow",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center",children:(0,r.jsx)(o.A,{className:"w-5 h-5 text-blue-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-gray-900",children:"새 배너 만들기"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"광고 이미지 등록 및 배치"})]}),(0,r.jsx)(u.A,{className:"w-4 h-4 text-gray-400 ml-auto"})]}),(0,r.jsxs)(i(),{href:"/admin/ops/flags",className:"flex items-center gap-3 p-4 bg-white border border-gray-200 rounded-xl hover:shadow-md transition-shadow",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-lg bg-green-50 flex items-center justify-center",children:(0,r.jsx)(d.A,{className:"w-5 h-5 text-green-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-gray-900",children:"기능 플래그 관리"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"A/B 테스트 및 기능 활성화"})]}),(0,r.jsx)(u.A,{className:"w-4 h-4 text-gray-400 ml-auto"})]})]})]})}},1847:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(2115);let n=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim()};var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,r.forwardRef)((e,t)=>{let{color:a="currentColor",size:i=24,strokeWidth:l=2,absoluteStrokeWidth:o,className:d="",children:c,iconNode:u,...m}=e;return(0,r.createElement)("svg",{ref:t,...s,width:i,height:i,stroke:a,strokeWidth:o?24*Number(l)/Number(i):l,className:n("lucide",d),...m},[...u.map(e=>{let[t,a]=e;return(0,r.createElement)(t,a)}),...Array.isArray(c)?c:[c]])}),l=(e,t)=>{let a=(0,r.forwardRef)((a,s)=>{let{className:l,...o}=a;return(0,r.createElement)(i,{ref:s,iconNode:t,className:n("lucide-".concat(e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),l),...o})});return a.displayName="".concat(e),a}},2196:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(1847).A)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]])},2979:(e,t,a)=>{Promise.resolve().then(a.bind(a,884))},2987:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(1847).A)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},4347:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(1847).A)("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]])},6132:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(1847).A)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},6983:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(1847).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},9630:(e,t,a)=>{"use strict";a.d(t,{AO:()=>f,E3:()=>N,FR:()=>h,LO:()=>w,WR:()=>v,Xo:()=>b,Zt:()=>_,_v:()=>C,cQ:()=>x,cb:()=>u,g8:()=>T,j$:()=>g,jB:()=>k,jd:()=>m,lA:()=>c,ny:()=>A,qs:()=>p,s1:()=>y,tV:()=>Z,wx:()=>B,yZ:()=>E,zU:()=>j});var r=a(5417),n=a(7376),s=a(5704);let i=[{id:"demo-banner-1",title:"신규 아티스트 오픈 기념 이벤트",placement:"home_top",image_url:"https://picsum.photos/seed/banner1/800/400",link_url:"/discover",link_type:"internal",status:"published",priority:10,start_at:null,end_at:null,target_audience:"all",version:2,published_snapshot:null,created_by:"demo-ops-1",updated_by:"demo-ops-1",created_at:"2025-12-01T00:00:00Z",updated_at:"2025-12-10T00:00:00Z"},{id:"demo-banner-2",title:"VIP 전용 특별 혜택",placement:"home_bottom",image_url:"https://picsum.photos/seed/banner2/800/400",link_url:"/subscriptions",link_type:"internal",status:"draft",priority:5,start_at:null,end_at:null,target_audience:"vip",version:1,published_snapshot:null,created_by:"demo-ops-1",updated_by:null,created_at:"2025-12-15T00:00:00Z",updated_at:"2025-12-15T00:00:00Z"}],l=[{id:"demo-flag-1",flag_key:"dark_mode_v2",title:"다크 모드 v2",description:"새로운 다크 모드 디자인 테스트",status:"published",enabled:!0,rollout_percent:50,payload:{variant:"new_palette"},version:3,published_snapshot:null,created_by:"demo-ops-1",updated_by:"demo-ops-1",created_at:"2025-11-01T00:00:00Z",updated_at:"2025-12-05T00:00:00Z"},{id:"demo-flag-2",flag_key:"gift_feature",title:"선물 기능",description:"팬 간 선물 전송 기능",status:"draft",enabled:!1,rollout_percent:0,payload:{},version:1,published_snapshot:null,created_by:"demo-ops-1",updated_by:null,created_at:"2025-12-20T00:00:00Z",updated_at:"2025-12-20T00:00:00Z"}],o=[{id:"demo-audit-1",actor_id:"demo-ops-1",actor_role:"publisher",action:"banner.publish",entity_type:"ops_banners",entity_id:"demo-banner-1",before:{status:"in_review"},after:{status:"published"},metadata:{},created_at:"2025-12-10T14:30:00Z"},{id:"demo-audit-2",actor_id:"demo-ops-1",actor_role:"operator",action:"flag.create",entity_type:"ops_feature_flags",entity_id:"demo-flag-2",before:null,after:{flag_key:"gift_feature",title:"선물 기능"},metadata:{},created_at:"2025-12-20T09:00:00Z"},{id:"demo-audit-3",actor_id:"demo-ops-2",actor_role:"admin",action:"settlement.approve",entity_type:"settlements",entity_id:"settlement-2026-01-waker",before:{status:"pending"},after:{status:"approved",title:"WAKER 2026-01월 정산 승인"},metadata:{artist_name:"WAKER",period:"2026-01"},created_at:"2026-02-05T10:15:00Z"},{id:"demo-audit-4",actor_id:"demo-ops-2",actor_role:"admin",action:"settlement.reject",entity_type:"settlements",entity_id:"settlement-2026-01-moonlight",before:{status:"pending"},after:{status:"rejected",reason:"서류 미비",title:"MOONLIGHT 정산 반려 (서류 미비)"},metadata:{artist_name:"MOONLIGHT",period:"2026-01"},created_at:"2026-02-07T14:22:00Z"},{id:"demo-audit-5",actor_id:"demo-ops-3",actor_role:"moderator",action:"creator.warn",entity_type:"creators",entity_id:"creator-starlight",before:{warning_count:0},after:{warning_count:1,title:"크리에이터 '별빛' 경고 발송"},metadata:{reason:"부적절한 콘텐츠 게시"},created_at:"2026-02-08T16:45:00Z"},{id:"demo-audit-6",actor_id:"demo-ops-3",actor_role:"moderator",action:"creator.suspend",entity_type:"creators",entity_id:"creator-baduser",before:{status:"active"},after:{status:"suspended",title:"크리에이터 '악성유저' 정지 처리"},metadata:{reason:"약관 위반 (중복)",duration_days:30},created_at:"2026-02-10T11:30:00Z"},{id:"demo-audit-7",actor_id:"demo-ops-4",actor_role:"moderator",action:"report.resolve",entity_type:"reports",entity_id:"rpt-002",before:{status:"reviewing"},after:{status:"resolved",title:"신고 #rpt-002 해결 처리",action_taken:"경고 발송"},metadata:{report_type:"harassment"},created_at:"2026-02-11T09:18:00Z"},{id:"demo-audit-8",actor_id:"demo-ops-5",actor_role:"operator",action:"payment.refund",entity_type:"payments",entity_id:"pay-007",before:{status:"completed"},after:{status:"refunded",title:"펀딩 결제 환불 처리 (#pay-007)",amount:9900},metadata:{reason:"고객 요청",refund_method:"original"},created_at:"2026-02-12T13:50:00Z"}];async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=function(){let e=s.env.NEXT_PUBLIC_SUPABASE_URL||"",t=s.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"";return(0,r.createBrowserClient)(e,t)}(),{data:{session:n}}=await a.auth.getSession();if(!(null==n?void 0:n.access_token))throw Error("인증이 필요합니다. 다시 로그인해주세요.");let i="".concat(s.env.NEXT_PUBLIC_SUPABASE_URL,"/functions/v1/ops-manage"),l=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n.access_token)},body:JSON.stringify({action:e,payload:t})}),o=await l.json();if(!o.success)throw Error(o.error||"요청 실패 (".concat(l.status,")"));return o.data}async function c(){return n.Gc?[]:d("staff.list")}async function u(e,t,a){return d("staff.upsert",{target_user_id:e,role:t,display_name:a})}async function m(e){await d("staff.remove",{target_user_id:e})}async function p(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.Gc?{items:[],total:0}:d("asset.list",e)}async function h(e){return d("asset.upload_complete",e)}async function f(e){await d("asset.delete",{id:e})}async function y(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.Gc?i:d("banner.list",e)}async function g(e){if(n.Gc){let t=i.find(t=>t.id===e);if(!t)throw Error("배너를 찾을 수 없습니다");return t}return d("banner.get",{id:e})}async function _(e){return n.Gc?{...i[0],...e,id:"demo-banner-".concat(Date.now()),status:"draft",version:1}:d("banner.create",{...e})}async function x(e,t,a){if(n.Gc){let r=i.find(t=>t.id===e);if(!r)throw Error("배너를 찾을 수 없습니다");return{...r,...a,version:t+1}}return d("banner.update",{id:e,expected_version:t,...a})}async function b(e,t){return d("banner.submit_review",{id:e,expected_version:t})}async function v(e,t){return d("banner.publish",{id:e,expected_version:t})}async function w(e){return d("banner.rollback",{id:e})}async function j(e,t){return d("banner.archive",{id:e,expected_version:t})}async function N(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.Gc?l:d("flag.list",e)}async function k(e){if(n.Gc){let t=l.find(t=>t.id===e);if(!t)throw Error("플래그를 찾을 수 없습니다");return t}return d("flag.get",{id:e})}async function A(e){return n.Gc?{...l[0],...e,payload:e.payload_data,id:"demo-flag-".concat(Date.now()),status:"draft",version:1}:d("flag.create",{...e})}async function E(e,t,a){if(n.Gc){let r=l.find(t=>t.id===e);if(!r)throw Error("플래그를 찾을 수 없습니다");return{...r,...a,version:t+1}}return d("flag.update",{id:e,expected_version:t,...a})}async function T(e,t){return d("flag.publish",{id:e,expected_version:t})}async function Z(e){return d("flag.rollback",{id:e})}async function C(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.Gc?{items:o,total:o.length}:d("audit.list",e)}async function B(){if(n.Gc)return{activeBanners:i.filter(e=>"published"===e.status).length,activeFlags:l.filter(e=>"published"===e.status).length,pendingReview:i.filter(e=>"in_review"===e.status).length,recentChanges:o.slice(0,5)};let[e,t,a]=await Promise.all([y(),N(),C({limit:5})]);return{activeBanners:e.filter(e=>"published"===e.status).length,activeFlags:t.filter(e=>"published"===e.status).length,pendingReview:e.filter(e=>"in_review"===e.status).length,recentChanges:a.items}}}},e=>{e.O(0,[2619,5417,7376,8441,1255,7358],()=>e(e.s=2979)),_N_E=e.O()}]);