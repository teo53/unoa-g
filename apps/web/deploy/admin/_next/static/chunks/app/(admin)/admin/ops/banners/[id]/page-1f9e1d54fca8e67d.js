(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9722],{1786:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(1847).A)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},4722:(e,a,t)=>{Promise.resolve().then(t.bind(t,7907))},5534:(e,a,t)=>{"use strict";t.d(a,{A:()=>b});var s=t(5155),r=t(2115),l=t(5229),n=t(1786),i=t(2529),d=t(8314),o=t(5417),c=t(7376),u=t(9630),x=t(5704);let m={idle:"",validating:"파일 검증 중...",uploading:"업로드 중...",registering:"등록 중...",done:"완료",error:"실패"},g={idle:0,validating:10,uploading:50,registering:85,done:100,error:0};function b(e){var a;let{onUploadComplete:t,accept:b="image/*",maxSizeMb:h=5,tags:p=[]}=e,y=(0,r.useRef)(null),[v,j]=(0,r.useState)(!1),[f,N]=(0,r.useState)("idle"),[w,_]=(0,r.useState)(null),[k,C]=(0,r.useState)(null),[S,P]=(0,r.useState)(null),E=(0,r.useRef)(null),A="idle"!==f&&"done"!==f&&"error"!==f,U=g[f],B=(0,r.useCallback)(()=>{N("idle"),_(null),C(null),P(null),E.current&&(E.current.abort(),E.current=null),y.current&&(y.current.value="")},[]),D=(0,r.useCallback)(async e=>{if(C(null),P(e),N("validating"),e.size>1024*h*1024){C("파일 크기는 ".concat(h,"MB 이하여야 합니다.")),N("error");return}if(!e.type.startsWith("image/")){C("이미지 파일만 업로드 가능합니다."),N("error");return}let a=URL.createObjectURL(e);if(_(a),c.Gc){N("done"),t({id:"demo-asset-".concat(Date.now()),file_name:e.name,storage_path:"ops/".concat(e.name),public_url:a,mime_type:e.type,file_size:e.size,width:null,height:null,tags:p,alt_text:"",uploaded_by:"demo-ops-1",created_at:new Date().toISOString()}),setTimeout(B,1500);return}E.current=new AbortController;try{N("uploading");let s=(0,o.createBrowserClient)(x.env.NEXT_PUBLIC_SUPABASE_URL||"",x.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||""),r=e.name.split(".").pop()||"png",l="banners/".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2),".").concat(r),{error:n}=await s.storage.from("ops-assets").upload(l,e,{contentType:e.type,cacheControl:"3600"});if(n)throw n;let{data:i}=s.storage.from("ops-assets").getPublicUrl(l),d=new Image;d.src=a,await new Promise(e=>d.onload=e),N("registering");let c=await (0,u.FR)({file_name:e.name,storage_path:l,public_url:i.publicUrl,mime_type:e.type,file_size:e.size,width:d.naturalWidth,height:d.naturalHeight,tags:p,alt_text:""});N("done"),t(c),setTimeout(B,1500)}catch(e){var s;if(null==(s=E.current)?void 0:s.signal.aborted)return;C(e instanceof Error?e.message:"업로드 실패"),N("error")}},[h,p,t,B]),R=(0,r.useCallback)(()=>{S&&D(S)},[S,D]),T=(0,r.useCallback)(()=>{E.current&&E.current.abort(),B()},[B]),L=(0,r.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?j(!0):"dragleave"===e.type&&j(!1)},[]),O=(0,r.useCallback)(e=>{var a;e.preventDefault(),e.stopPropagation(),j(!1),(null==(a=e.dataTransfer.files)?void 0:a[0])&&D(e.dataTransfer.files[0])},[D]),z=(0,r.useCallback)(e=>{var a;(null==(a=e.target.files)?void 0:a[0])&&D(e.target.files[0])},[D]);return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"relative border-2 border-dashed rounded-lg p-6 text-center transition-colors\n          ".concat(v?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400","\n          ").concat(A?"pointer-events-none":"cursor-pointer","\n        "),onDragEnter:L,onDragLeave:L,onDragOver:L,onDrop:O,onClick:()=>{var e;return!A&&!w&&(null==(e=y.current)?void 0:e.click())},children:[(0,s.jsx)("input",{ref:y,type:"file",accept:b,className:"hidden",onChange:z}),w?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("img",{src:w,alt:"Preview",className:"max-h-48 mx-auto rounded object-contain"}),"idle"===f&&(0,s.jsx)("button",{className:"absolute top-1 right-1 bg-white rounded-full p-1 shadow hover:bg-gray-100",onClick:e=>{e.stopPropagation(),B()},children:(0,s.jsx)(l.A,{className:"w-4 h-4"})})]}):(0,s.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,s.jsx)(n.A,{className:"w-8 h-8 text-gray-400"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"이미지를 드래그하거나 클릭하여 업로드"}),(0,s.jsxs)("p",{className:"text-xs text-gray-400",children:["최대 ",h,"MB / PNG, JPG, WebP"]})]}),(A||"done"===f)&&(0,s.jsxs)("div",{className:"mt-4 space-y-2",children:[S&&(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2 text-xs text-gray-500",children:[(0,s.jsx)("span",{className:"truncate max-w-[200px]",children:S.name}),(0,s.jsx)("span",{children:(a=S.size)<1024?"".concat(a," B"):a<1048576?"".concat((a/1024).toFixed(1)," KB"):"".concat((a/1048576).toFixed(1)," MB")})]}),(0,s.jsx)("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden mx-auto max-w-xs",children:(0,s.jsx)("div",{className:"h-full rounded-full transition-all duration-500 ease-out ".concat("done"===f?"bg-green-500":"bg-blue-500"),style:{width:"".concat(U,"%")}})}),(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2",children:["done"===f?(0,s.jsx)(i.A,{className:"w-4 h-4 text-green-500"}):(0,s.jsx)("span",{className:"w-3.5 h-3.5 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),(0,s.jsx)("span",{className:"text-xs text-gray-600",children:m[f]})]}),A&&(0,s.jsx)("button",{className:"text-xs text-gray-500 hover:text-gray-700 underline pointer-events-auto",onClick:e=>{e.stopPropagation(),T()},children:"취소"})]})]}),"error"===f&&(0,s.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,s.jsx)("span",{className:"text-red-600 flex-1",children:k}),S&&(0,s.jsxs)("button",{className:"inline-flex items-center gap-1 text-blue-600 hover:text-blue-800 text-xs font-medium",onClick:R,children:[(0,s.jsx)(d.A,{className:"w-3.5 h-3.5"}),"다시 시도"]}),(0,s.jsx)("button",{className:"text-xs text-gray-500 hover:text-gray-700",onClick:B,children:"닫기"})]})]})}},7907:(e,a,t)=>{"use strict";t.d(a,{default:()=>g});var s=t(5155),r=t(2115),l=t(2619),n=t.n(l),i=t(5626),d=t(9630),o=t(6738),c=t(8876),u=t(3791),x=t(8708),m=t(5534);function g(e){let{id:a}=e,[t,l]=(0,r.useState)(null),[g,b]=(0,r.useState)(!0),[h,p]=(0,r.useState)(!1),[y,v]=(0,r.useState)(null),[j,f]=(0,r.useState)(null),[N,w]=(0,r.useState)(""),[_,k]=(0,r.useState)("home_top"),[C,S]=(0,r.useState)(""),[P,E]=(0,r.useState)(""),[A,U]=(0,r.useState)("internal"),[B,D]=(0,r.useState)(0),[R,T]=(0,r.useState)(""),[L,O]=(0,r.useState)(""),[z,I]=(0,r.useState)("all"),M=(0,r.useCallback)(async()=>{try{let e=await (0,d.j$)(a);l(e),w(e.title),k(e.placement),S(e.image_url),E(e.link_url),U(e.link_type),D(e.priority),T(e.start_at||""),O(e.end_at||""),I(e.target_audience)}catch(e){v(e instanceof Error?e.message:"배너를 불러올 수 없습니다")}finally{b(!1)}},[a]);function W(e){f(e),setTimeout(()=>f(null),3e3)}async function F(){if(t){p(!0),v(null);try{let e=await (0,d.cQ)(a,t.version,{title:N,placement:_,image_url:C,link_url:P,link_type:A,priority:B,start_at:R,end_at:L,target_audience:z});l(e),W("초안이 저장되었습니다")}catch(e){v(e instanceof Error?e.message:"저장 실패")}finally{p(!1)}}}async function G(){if(t)try{let e=await (0,d.Xo)(a,t.version);l(e),W("검수 요청이 완료되었습니다")}catch(e){v(e instanceof Error?e.message:"검수 요청 실패")}}async function X(){if(t)try{let e=await (0,d.WR)(a,t.version);l(e),W("배너가 게시되었습니다")}catch(e){v(e instanceof Error?e.message:"게시 실패")}}async function H(){if(t)try{let e=await (0,d.LO)(a);l(e),W("롤백이 완료되었습니다")}catch(e){v(e instanceof Error?e.message:"롤백 실패")}}async function K(){if(t)try{let e=await (0,d.zU)(a,t.version);l(e),W("배너가 보관되었습니다")}catch(e){v(e instanceof Error?e.message:"보관 실패")}}if((0,r.useEffect)(()=>{M()},[M]),g)return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"h-8 w-48 bg-gray-100 rounded animate-pulse"}),(0,s.jsx)("div",{className:"h-64 bg-gray-100 rounded-xl animate-pulse"})]});if(!t)return(0,s.jsx)("p",{className:"text-gray-500",children:"배너를 찾을 수 없습니다."});let J="draft"===t.status||"in_review"===t.status;return(0,s.jsxs)("div",{className:"max-w-4xl space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(n(),{href:"/admin/ops/banners",className:"text-gray-500 hover:text-gray-700",children:(0,s.jsx)(i.A,{className:"w-5 h-5"})}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:t.title}),(0,s.jsx)(c.a,{status:t.status})]}),y&&(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-700",children:[y,(0,s.jsx)("button",{className:"ml-2 underline",onClick:()=>v(null),children:"닫기"})]}),j&&(0,s.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 text-sm text-green-700",children:j}),(0,s.jsx)(u.r,{status:t.status,version:t.version,hasPublishedSnapshot:!!t.published_snapshot,onSaveDraft:F,onSubmitReview:G,onPublish:X,onRollback:H,onArchive:K,disabled:h}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"lg:col-span-2 space-y-5 bg-white border border-gray-200 rounded-xl p-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"제목"}),(0,s.jsx)("input",{type:"text",className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm disabled:bg-gray-50",value:N,onChange:e=>w(e.target.value),disabled:!J})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"배치 위치"}),(0,s.jsx)("select",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm disabled:bg-gray-50",value:_,onChange:e=>k(e.target.value),disabled:!J,children:Object.entries(o.et).map(e=>{let[a,t]=e;return(0,s.jsx)("option",{value:a,children:t},a)})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"이미지"}),C?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("img",{src:C,alt:"Banner",className:"w-full max-h-48 object-contain rounded border"}),J&&(0,s.jsx)("button",{className:"absolute top-2 right-2 bg-white text-xs px-2 py-1 rounded shadow",onClick:()=>S(""),children:"변경"})]}):J?(0,s.jsx)(m.A,{onUploadComplete:e=>S(e.public_url),tags:["banner"]}):(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"이미지 없음"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"링크 타입"}),(0,s.jsxs)("select",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm disabled:bg-gray-50",value:A,onChange:e=>U(e.target.value),disabled:!J,children:[(0,s.jsx)("option",{value:"internal",children:"내부"}),(0,s.jsx)("option",{value:"external",children:"외부"}),(0,s.jsx)("option",{value:"none",children:"없음"})]})]}),"none"!==A&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"링크 URL"}),(0,s.jsx)("input",{type:"text",className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm disabled:bg-gray-50",value:P,onChange:e=>E(e.target.value),disabled:!J})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"우선순위"}),(0,s.jsx)("input",{type:"number",className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm disabled:bg-gray-50",value:B,onChange:e=>D(parseInt(e.target.value)||0),disabled:!J})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"대상"}),(0,s.jsxs)("select",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm disabled:bg-gray-50",value:z,onChange:e=>I(e.target.value),disabled:!J,children:[(0,s.jsx)("option",{value:"all",children:"전체"}),(0,s.jsx)("option",{value:"fans",children:"팬"}),(0,s.jsx)("option",{value:"creators",children:"크리에이터"}),(0,s.jsx)("option",{value:"vip",children:"VIP"})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작일"}),(0,s.jsx)("input",{type:"datetime-local",className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm disabled:bg-gray-50",value:R,onChange:e=>T(e.target.value),disabled:!J})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료일"}),(0,s.jsx)("input",{type:"datetime-local",className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm disabled:bg-gray-50",value:L,onChange:e=>O(e.target.value),disabled:!J})]})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:"변경 이력"}),(0,s.jsx)(x.s,{entityType:"ops_banners",entityId:a})]})]})]})}}},e=>{e.O(0,[2619,5417,7376,8017,3582,8441,1255,7358],()=>e(e.s=4722)),_N_E=e.O()}]);